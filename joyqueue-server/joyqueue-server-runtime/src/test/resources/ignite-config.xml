<?xml version="1.0" encoding="UTF-8"?>

<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!-- 临时 -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd">
    <!--
        Alter configuration below as needed.
    -->
    <bean id="igniteCfg" class="org.apache.ignite.configuration.IgniteConfiguration">

        <!-- 分布式计算class传播 -->
        <property name="peerClassLoadingEnabled" value="true"/>

        <!-- Set deployment mode. -->
        <!-- 部署模式，控制类加载. -->
        <property name="deploymentMode" value="SHARED"/>

        <!-- Disable missed resources caching. -->
        <!-- 禁用丢失资源缓存 -->
        <property name="peerClassLoadingMissedResourcesCacheSize" value="0"/>

        <!-- 设为false表示服务端模式 -->
        <property name="clientMode" value="false"/>

        <!-- Network timeout -->
        <!-- 连接超时时间 -->
        <property name="networkTimeout" value="10000" />

        <property name="binaryConfiguration" >
            <bean class="org.apache.ignite.configuration.BinaryConfiguration">
                <property name="compactFooter" value="false"/>
            </bean>
        </property>
        <!--Exclude force peer class loading of a class, even if exists locally.-->
        <!-- 配置需要传播的class的路径 -->
        <!-- Configure internal thread pool. -->
        <!-- 公共线程池大小-->
        <property name="publicThreadPoolSize" value="64"/>

        <!-- Configure system thread pool. -->
        <!-- 系统线程池大小-->
        <property name="systemThreadPoolSize" value="32"/>

        <property name="cacheConfiguration">
            <list>
                <bean class="org.apache.ignite.configuration.CacheConfiguration">
                    <!-- 缓存名-->
                    <property name="name" value="IGNITE_CACHE_KEY_PCOMM_RATE"/>
                    <!-- 原子模式类型，ATOMIC:原子型，保证性能; TRANSACTIONAL:事务型,分布式锁-->
                    <property name="atomicityMode" value="TRANSACTIONAL"/>
                    <!--PARTITIONED:分区; REPLICATED:复制；LOCAL：本地 -->
                    <property name="cacheMode" value="REPLICATED"/>
                    <!-- 备份数量-->
                    <property name="backups" value="1"/>
                    <!-- 禁用jcache标准中缓存读取获取的是副本的机制 -->
                    <property name="copyOnRead" value="false"/>
                    <!-- 内存区名-->
                    <property name="dataRegionName" value="joyqueueRegion"/>
                    <!-- 是否以二进制形式存储-->
                    <property name="storeKeepBinary" value="true"/>
                    <!--<property name="writeBehindEnabled" value="true"/>-->
                </bean>
            </list>
        </property>

        <!-- Redefining maximum memory size for the cluster node usage. -->
        <property name="dataStorageConfiguration">
            <bean class="org.apache.ignite.configuration.DataStorageConfiguration">
                <!-- Redefining the default region's settings -->
                <!-- 默认存储区间配置-->
                <property name="defaultDataRegionConfiguration">
                    <bean class="org.apache.ignite.configuration.DataRegionConfiguration">
                        <!-- 存储区名-->
                        <property name="name" value="joyqueueRegion"/>
                        <!-- 存储区大小-->
                        <!-- Setting the size of the default region to 1GB. -->
                        <!--<property name="maxSize" value="#{1L * 1024 * 1024 * 1024}"/>-->
                        <property name="initialSize" value="#{100 * 1024 * 1024}"/>
                        <property name="maxSize" value="#{512 * 1024 * 1024}"/>
                        <!-- 是否开启持久化-->
                        <!-- Enabling Apache Ignite Persistent Store. -->
                        <property name="persistenceEnabled" value="false"/>
                    </bean>
                </property>
                <property name="dataRegionConfigurations">
                    <list>
                        <!-- 自定义内存区-->
                        <!--
                            Defining a data region that will consume up to 500 MB of RAM and
                            will have eviction and persistence enabled.
                        -->
                        <bean class="org.apache.ignite.configuration.DataRegionConfiguration">
                            <!-- Custom region name. -->
                            <property name="name" value="udfRegion"/>
                            <!-- 100 MB initial size. -->
                            <property name="initialSize" value="#{100L * 1024 * 1024}"/>
                            <!-- 500 MB maximum size. -->
                            <property name="maxSize" value="#{500L * 1024 * 1024}"/>
                            <!-- Enabling persistence for the region. -->
                            <property name="persistenceEnabled" value="false"/>
                        </bean>
                    </list>
                </property>

                <!-- 预写日志模式-->
                <!-- Sets property that defines behavior of wal fsync. -->
                <!--<property name="walMode">-->
                <!--<util:constant static-field="org.apache.ignite.configuration.WALMode.DEFAULT"/>-->
                <!--</property>-->
                <property name="walMode" value="DEFAULT"/>

                <!-- 检查点频率-->
                <!--Checkpointing frequency which is a minimal interval when the dirty pages will be written to the Persistent Store.-->
                <property name="checkpointFrequency" value="180000"/>
                <!--<property name="checkpointFrequency" value="10000"/>-->

                <!-- 检查点线程数-->
                <!-- Number of threads for checkpointing.-->
                <property name="checkpointThreads" value="4"/>

                <!-- 在检查点同步完成后预写日志历史保留数量 -->
                <!-- Number of checkpoints to be kept in WAL after checkpoint is finished.-->
                <property name="walHistorySize" value="20"/>
                <!--<property name="walHistorySize" value="2"/>-->

                <!-- 持久化文件路径 -->
                <!-- Path where data and indexes will be persisted. -->
                <property name="storagePath" value="/export/Data/ignite/cache/nameserver/persisted" />

                <!--&lt;!&ndash; Path to the directory where WAL (Write Ahead Log) is stored. &ndash;&gt;-->
                <property name="walPath" value="/export/Data/ignite/cache/nameserver/wal" />

                <!--&lt;!&ndash; Path to the directory where WAL (Write Ahead Log) archive is stored. &ndash;&gt;-->
                <property name="walArchivePath" value="/export/Data/ignite/cache/nameserver/archive" />

            </bean>
        </property>

        <property name="discoverySpi">
            <bean class="org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi">
                <property name="localPort" value="48500"/>
                <property name="localPortRange" value="20"/>
                <property name="joinTimeout" value="0"/>
                <property name="networkTimeout" value="5000" />
                <property name="ipFinder">
                    <bean class="org.apache.ignite.spi.discovery.tcp.ipfinder.multicast.TcpDiscoveryMulticastIpFinder">
                        <property name="addresses">
                            <!-- 集群ip列表-->
                            <list>
                                <!--<value>11.5.102.162:48500..48520</value>-->
                            </list>
                        </property>
                    </bean>
                </property>
            </bean>
        </property>
        <property name="communicationSpi">
            <bean class="org.apache.ignite.spi.communication.tcp.TcpCommunicationSpi">
                <property name="localPort" value="48100"/>
            </bean>
        </property>
    </bean>
</beans>
